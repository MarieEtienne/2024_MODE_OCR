---
title: "Effets du pâturage sur les prairies suédoises"
author: "Bastien, Elia, Caroline, Alexia, Marine, Lily, Julie" 
bibliography: references.bib
execute: 
  freeze: auto
output: 
  html_document:
   toc: true
   toc_float: true
---

Les ecosystemes terrestres ont ete domines pendant plusieurs millions d'annees par les grands mammiferes herbivores, qui ont ensuite decline à la fin du Pleistocene sous la pression des premieres populations humaines prehistoriques. La perte de ces especes de grands herbivores (aurochs, chevaux et anes sauvages, rhinoceros laineux...) a egalement ete synonyme de la perte des services ecosystemiques qu'ils apportaient. @lundgren2020human

Depuis plusieurs annees, le courant du reensauvagement ("rewilding" en anglais) a pour but de restaurer ces services ecosytemique en reintroduisant des especes dans les grands espaces naturels europeens.L'etude presente cherche a evaluer dans quelle mesure les especes d'herbivores introduites ont une influence sur la vegetation. @garido2019experimental

PRESENTATION DE L'EXPERIENCE

Le site d'etude est situe a environ 17 km au Sud d'Uppsala. Sur ce site d'etude, trois parcelles ont ete utilisees. Chaque parcelle a ete divisee en deux, avec une partie non paturee et une partie paturee. Quatre jeunes etalons de race Gotland ont ete places dans chaque partie dediee au paturage pendant trois ans.

De nombreuses variables ont ete etudiees :
- la hauteur des plantes a maturite
- le poids des graines
- le nombre d'especes differentes
- la surface de parcelle occupee par des plantes anemogames 
- la surface de parcelle occupee par des plantes entomogames 
- le RCS score *
D'autres informations ont ete notees a chaque releve comme la saison, l'annee et l'observateur qui a realise l'inventaire. Des informations sur les insectes trouves sur la parcelle ont aussi ete relevees mais ne seront pas utilisees dans notre analyse.

* Le score RCS correspond a un indice de strategie utilisee par les plantes @Wood2018microbiomes

PROBLEMATIQUES

Nous avons choisi d'utiliser le jeu de donnees de @garido2019experimental pour repondre a trois problematiques differentes. Tout d'abord, est-ce que le paturage a un effet sur la richesse specifique vegetale des parcelles ? Ensuite, est-ce que le paturage a un effet sur la morphologie des plantes ? Et enfin, le paturage a-t-il un effet sur la strategie de pollinisation des plantes ?

Pour repondre a ces questions, nous avons transforme le jeu de donnees initial pour obtenir un jeu de donnees de 404 releves. Les variables utilisees sont les suivantes :
- treatment 
- season
- year
- cover.area.bee 
- cover.area.gene
- logh
- logS
- richness
- observer
- R.score
- S.score
- C.score
- ratio poll

IMPORTATION DU JEU DE DONNEES 

```{r}
df <- read.table('pollen.csv', sep = ';', header = TRUE)
```

IMPORTATION DES PACKAGES

```{r}

library(tidyverse)
library(FactoMineR)
library(dplyr)
```


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      PARTIE 1 : Effet du paturage sur la richesse specifique
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# Visualisation des donnees
```{r}
ggplot(data=df)+
  geom_boxplot(aes(x=treatment, y=num.species))+
  geom_jitter(aes(x=treatment, y=num.species)) + 
  labs(x="Treatment", y="Species richness") +
  ggtitle('Effect of grassland on species richness')
```
La richesse specifique des zones paturees semble etre plus importante que dans les zones non paturees. 

```{r}
hyp1<-lm(num.species~1,data=df)
hyp0<-lm(num.species~treatment,data=df)
anova(hyp0,hyp1)
```
La p-value est inferieure a 0,05 donc le paturage a un effet significatif sur la richesse specifique. 

# Choix du modele : dans cette partie, nous considerons que le paturage (treatment) depend de la saison et de l'annee d'observation. 

```{r}
modComplet<-LinearModel(num.species~(treatment+season+year)*(treatment),data=df,selection = "aic")
modComplet
```
Les resultats pour le modele complet sont les suivants : p-value: 2.554e-16, AIC = 649, BIC = 681
Cependant, le modele choisi selon le critere AIC montre les resultats suivants : p-value: 1.41e-17, 
AIC = 645.2 et BIC = 669.2. Le critere AIC etant plus petit pour ce modele que le modele complet, on choisit
de conserver : num.species ~ treatment + season + year + treatment:year. Il y a donc interaction entre le paturage et son annee d'observation.   

# Validation du modele choisi avec le test de Bartlett

```{r}
modelAIC<-lm(num.species~treatment+season+year+treatment:year,data=df)

res<-residuals(modelAIC)
boxplot(res~treatment,data=df)
bartlett.test(res~treatment,data=df)

boxplot(res~season,data=df)
bartlett.test(res~season,data=df)

boxplot(res~year,data=df)
bartlett.test(res~year,data=df)

boxplot(res~treatment:year,data=df)
df$interaction <- interaction(df$treatment, df$year)
bartlett.test(res ~ interaction, data = df)
```

Pour les tests de Bartlett, les p-value sont toutes supérieures à 0.05, ce qui veut dire que l'homoscédasticité est respectée pour tous nos parametres soit que les variances sont toutes egales pour toutes nos observations.

hist(res,main="Histogramme residus",xlab="Residus")
shapiro.test(res)

La normalite des residus est respectee car notre p-value est superieure a 0,05 : les donnees sont compatibles avec une distribution normale. Notre modele lineaire est donc valide car la normalite des residus est une hypothese cle pour appliquer ce modele. 

# Conclusion partie 1

La richesse spécifique depend donc du paturage, de la saison et de l’annee, ainsi que de l’interaction
paturage:annee.  

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                       Partie 2 : effet du paturage sur la morphologie des plantes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Nous pouvons tout d'abord effectuer une observation graphique des donnees.

#Taille
Commencons par representer la taille des plantes en fonction du paturage.

```{r}
boxplot(df$logHeight.score~df$?..treatment, varwidth = TRUE, ylab = "LogH", xlab = "Treatment", col='darkgrey', main = "", title = "effet du p?turage sur la hauteur")

ggplot(data=df)+
  geom_boxplot(aes(x=?..treatment, y=logHeight.score))+
  geom_jitter(aes(x=?..treatment, y=logHeight.score))
```

#Masse
Etudions a present la masse des graines des plantes en fonction du paturage.

```{r}
boxplot(df$logSeedMass.score~df$?..treatment, varwidth = TRUE, ylab = "LogS", xlab = "Treatment", col='darkgrey', main = "", title = "effet du paturage sur la masse des graines")

ggplot(data=df)+
  geom_boxplot(aes(x=?..treatment, y=logSeedMass.score))+
  geom_jitter(aes(x=?..treatment, y=logSeedMass.score))
```

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                          PARTIE 3: GRAZING EFFECT ON POLLINISATION STRATEGIES 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Data importation


```{r pollen_read_data}
df <- read_delim("pollen.csv", delim = ";", 
    escape_double = FALSE, trim_ws = TRUE)
```



```{r rename_firstvariable}


# renommer la premiere colonne pour Marine et Alexia car var treatment est ?..treatment et pose pblm
names(df)[1] <- "treatment"
names(df)
```


```{r boxplot}
# Boxplot 
par(mfrow=c(1,2))

boxplot(df$RatioPoll~df$?..treatment, varwidth = TRUE, ylab = "Ratio Pollinisation", xlab = "treatment", col='blue', main = "")

```


The boxplot shows no significant differences between plots grazed and those not grazed.

```{r anova}
# Anova
poll1<-lm(RatioPoll~1,data=df)
poll2<-lm(RatioPoll~treatment,data=df)
anova(poll1,poll2)
```

The P-value is not significant at the 5% threshold, so we reject the hypothesis that grazing has an effect on the RatioPoll. The Anova test confirms our graphical observation: there is no difference between the grazed and natural plots.

```{r fullmodel}
poll3<-LinearModel(RatioPoll~(treatment+season+year+observer+R.score+S.score+C.score)*
                     (treatment+season+year+observer+R.score+S.score+C.score),data=df,selection = "aic")
poll3
```

The model proposed by R does have a lower BIC than our initial model. However, some of the interactions retained by R have no significant effect. We decided to test a model without these interactions. 

```{r coeff1}
poll4<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + S.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score + R.score:C.score),data=df)
poll4
```

We have observed that the R.score:C.score interaction is not significant, we test a new model without it.
```{r coeff2}
poll5<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + S.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
poll5
```

The p-value of S.score is not significant and does not appear in any significant interactions. We therefore decide to remove it

```{r coeff3}
poll6<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
poll6
```


Now,we want to check the normality of residuals 
```{r ResidNorm}
pollfinal<-lm(RatioPoll~(treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
res<-residuals(pollfinal)
hist(res,main="Histogram residuals",xlab="Residus")
shapiro.test(res)
```

The residuals are not normally distributed. We're going to try and do some transformations using log and sqrt.
```{r TransfoLog}
poll7<-LinearModel(log(RatioPoll+1)~(treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df )
poll7

```

The p-value of the shapiro test is still less than 0.05, so the residuals are still not normally distributed. 

```{r TransfoSqrt}
poll7<-LinearModel(sqrt(RatioPoll)~( season + C.score + treatment:R.score + 
    treatment:C.score + year:C.score ),data=df)
poll7

pollfinal<-lm(sqrt(RatioPoll)~( season + C.score + treatment:R.score + 
    treatment:C.score + year:C.score ),data=df)
res<-residuals(pollfinal)
hist(res,main="Histogram residuals",xlab="Residus")
shapiro.test(res)

```
 **Conclusion: ** We cannot evaluate the impact of grazing on the pollination strategy of plants because the constraints of the general linear model are not respected. In addition, we cannot apply a generalised linear model given the type and values of our data. 

