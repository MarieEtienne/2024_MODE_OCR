---
title: "Effets du pâturage sur les prairies suédoises"
author: "Bastien, Elia, Caroline, Alexia, Marine, Lily, Julie" 
bibliography: references.bib
execute: 
  freeze: auto
output: 
  html_document:
   toc: true
   toc_float: true
---

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      INTRODUCTION
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Terrestrial ecosystems were dominated for several million years by large herbivorous mammals, which then declined at the end of the Pleistocene under the pressure of the first prehistoric human populations. The loss of these large herbivore species (aurochs, wild horses and anes, woolly rhinoceros...) was also synonymous with the loss of the ecosystem services they provided. @lundgren2020human

For several years, the “rewilding” movement has been aiming to restore these ecosystem services by reintroducing species into large European natural areas, and the present study seeks to assess the extent to which introduced herbivore species have an influence on vegetation. @garido2019experimental

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      MATERIALS AND METHODS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


The study site is located approximately 17 km south of Uppsala, Sweden. On this study site, three plots were used. Each plot was divided in two, with an ungrazed part and a grazed part. Four young Gotland stallions were placed in each grazing area for three years.

Numerous variables were studied:
- plant height at maturity
- seed mass
- species richness
- plot area occupied by anemogamous plants 
- plot area occupied by entomogamous plants 
- RCS score *.
Other information was noted at each survey, such as the season, year and observer who carried out the inventory. Information on the insects found on the plot was also recorded, but will not be used in our analysis.

* The RCS score corresponds to an index of the strategy used by the plants. @Wood2018microbiomes

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      RESEARCH QUESTIONS
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

We have chosen to use the  @garido2019experimental dataset to answer three different questions. Firstly, does grazing have an effect on the plant species richness of plots? Secondly, does grazing have an effect on plant morphology? And finally, does grazing have an effect on plant pollination strategies?

To answer these questions, we transformed the initial dataset to obtain a dataset of 404 records. The variables used are :
- treatment (grazed or ungrazed)
- season
- year
- cover.area.bee (plot area occupied by entomogamous plants)
- cover.area.gene (plot area occupied by anemogamous plants)
- logh (log of plant height)
- logS (log of seed mass)
- richness (species richness)
- observer
- R.score
- S.score
- C.score
- ratio poll (cover.area.bee/cover.area.gene)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      DATA IMPORT
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


```{r}
df <- read.table('pollen.csv', sep = ';',stringsAsFactors=TRUE, header = TRUE)
df$year <- as.factor(df$year)
summary (df)
```

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      PACKAGES IMPORT
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


```{r}

library(tidyverse)
library(FactoMineR)
library(dplyr)
```


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                      PARTIE 1 : Effet du paturage sur la richesse specifique
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# Visualisation des donnees
```{r}
ggplot(data=df)+
  geom_boxplot(aes(x=treatment, y=num.species))+
  geom_jitter(aes(x=treatment, y=num.species)) + 
  labs(x="Treatment", y="Species richness") +
  ggtitle('Effect of grassland on species richness')
```
La richesse specifique des zones paturees semble etre plus importante que dans les zones non paturees. 

```{r}
hyp1<-lm(num.species~1,data=df)
hyp0<-lm(num.species~treatment,data=df)
anova(hyp0,hyp1)
```
La p-value est inferieure a 0,05 donc le paturage a un effet significatif sur la richesse specifique. 

# Choix du modele : dans cette partie, nous considerons que le paturage (treatment) depend de la saison et de l'annee d'observation. 

```{r}
modComplet<-LinearModel(num.species~(treatment+season+year)*(treatment),data=df,selection = "aic")
modComplet
```
Les resultats pour le modele complet sont les suivants : p-value: 2.554e-16, AIC = 649, BIC = 681
Cependant, le modele choisi selon le critere AIC montre les resultats suivants : p-value: 1.41e-17, 
AIC = 645.2 et BIC = 669.2. Le critere AIC etant plus petit pour ce modele que le modele complet, on choisit
de conserver : num.species ~ treatment + season + year + treatment:year. Il y a donc interaction entre le paturage et son annee d'observation.   

# Validation du modele choisi avec le test de Bartlett

```{r}
modelAIC<-lm(num.species~treatment+season+year+treatment:year,data=df)

res<-residuals(modelAIC)
boxplot(res~treatment,data=df)
bartlett.test(res~treatment,data=df)

boxplot(res~season,data=df)
bartlett.test(res~season,data=df)

boxplot(res~year,data=df)
bartlett.test(res~year,data=df)

boxplot(res~treatment:year,data=df)
df$interaction <- interaction(df$treatment, df$year)
bartlett.test(res ~ interaction, data = df)
```

Pour les tests de Bartlett, les p-value sont toutes supérieures à 0.05, ce qui veut dire que l'homoscédasticité est respectée pour tous nos parametres soit que les variances sont toutes egales pour toutes nos observations.

hist(res,main="Histogramme residus",xlab="Residus")
shapiro.test(res)

La normalite des residus est respectee car notre p-value est superieure a 0,05 : les donnees sont compatibles avec une distribution normale. Notre modele lineaire est donc valide car la normalite des residus est une hypothese cle pour appliquer ce modele. 

# Conclusion partie 1

La richesse spécifique depend donc du paturage, de la saison et de l’annee, ainsi que de l’interaction
paturage:annee.  


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                          PARTIE 3: GRAZING EFFECT ON POLLINISATION STRATEGIES 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Data importation


```{r pollen_read_data}
df <- read_delim("pollen.csv", delim = ";", 
    escape_double = FALSE, trim_ws = TRUE)
```



```{r boxplot}
# Boxplot 
par(mfrow=c(1,2))

boxplot(df$RatioPoll~df$treatment, varwidth = TRUE, ylab = "Ratio Pollinisation", xlab = "treatment", col='blue', main = "")

```


The boxplot shows no significant differences between plots grazed and those not grazed.

```{r anova}
# Anova
poll1<-lm(RatioPoll~1,data=df)
poll2<-lm(RatioPoll~treatment,data=df)
anova(poll1,poll2)
```

The P-value is not significant at the 5% threshold, so we reject the hypothesis that grazing has an effect on the RatioPoll. The Anova test confirms our graphical observation: there is no difference between the grazed and natural plots.

```{r fullmodel}
poll3<-LinearModel(RatioPoll~(treatment+season+year+observer+R.score+S.score+C.score)*
                     (treatment+season+year+observer+R.score+S.score+C.score),data=df,selection = "aic")
poll3
```

The model proposed by R does have a lower BIC than our initial model. However, some of the interactions retained by R have no significant effect. We decided to test a model without these interactions. 

```{r coeff1}
poll4<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + S.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score + R.score:C.score),data=df)
poll4
```

We have observed that the R.score:C.score interaction is not significant, we test a new model without it.
```{r coeff2}
poll5<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + S.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
poll5
```

The p-value of S.score is not significant and does not appear in any significant interactions. We therefore decide to remove it

```{r coeff3}
poll6<-LinearModel(RatioPoll~( treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
poll6
```


Now,we want to check the normality of residuals 
```{r ResidNorm}
pollfinal<-lm(RatioPoll~(treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df)
res<-residuals(pollfinal)
hist(res,main="Histogram residuals",xlab="Residus")
shapiro.test(res)
```

The residuals are not normally distributed. We're going to try and do some transformations using log and sqrt.
```{r TransfoLog}
poll7<-LinearModel(log(RatioPoll+1)~(treatment + season + year + 
    observer + R.score + C.score + treatment:R.score + 
    treatment:C.score + year:C.score + 
    observer:R.score ),data=df )
poll7

```

The p-value of the shapiro test is still less than 0.05, so the residuals are still not normally distributed. 

```{r TransfoSqrt}
poll7<-LinearModel(sqrt(RatioPoll)~( season + C.score + treatment:R.score + 
    treatment:C.score + year:C.score ),data=df)
poll7

pollfinal<-lm(sqrt(RatioPoll)~( season + C.score + treatment:R.score + 
    treatment:C.score + year:C.score ),data=df)
res<-residuals(pollfinal)
hist(res,main="Histogram residuals",xlab="Residus")
shapiro.test(res)

```
 **Conclusion: ** We cannot evaluate the impact of grazing on the pollination strategy of plants because the constraints of the general linear model are not respected. In addition, we cannot apply a generalised linear model given the type and values of our data. 

