---
editor: 
  markdown: 
    wrap: 72
---

------------------------------------------------------------------------

title: "Modèles matriciels et applications" group: "Rudy, Tanguy, Manon,
Garan, Anaëlle, Oceane, Victor"

bibliography: references.bib execute: freeze: auto output:
html_document: toc: true toc_float: true ---

Le lien du site : https://zenodo.org/records/8251495

Pistes

Calcul

Taux de succès Taux de survie

voir si habitat préférentiel, région,… voir quelles facteurs expliquent
taux de succès

voir si décalages entre dates de départ du nid -\> facteurs expliquant

voir si habitat préferentiel

MAIS ATTENTION à ne pas être biaisé : du genre que des oiseaux d’une
certaines espèces ne soit présents que dans un habitat

refaire analyse de bases cf ASA

# Document R modifié et avec ajouts

## Import des données

**Do not forget to set your working directory in the right place**
**Menu : Session/Set Working Directory/Choose directory** *And indicate
Git/2024_MODE_OCR*

```{r}
rm(list=ls()) # Properly clear workspace
library(knitr)
opts_chunk$set(echo = FALSE, comment = "", cache = TRUE, fig.align = "center")
library(ggplot2) # graph package
library(tinytex) # Pour la sortie pdf
library(corrplot)# Correlation matrix calculus
library(plot3D)# For 3D plot
library(DHARMa)# Model diagnosis
library(rcompanion)# Model pseudo R²
library(lattice)# Multipanel graphics
library(ggplot2)
library(MASS)
library(rcompanion)
```

```{r}
# Datatset import under the name of "data"
dataBirds <- read.csv("Bird_dataset.csv", sep=";", header = TRUE, stringsAsFactors = TRUE)
dataBirds$Nest_Fate <- as.factor(dataBirds$Nest_Fate)
#dataBirds$Year <- as.factor(dataBirds$Year)
#Verification de la presence de valeurs manquantes
colSums(is.na(dataBirds))
```

```{r}
# View the firsts lignes of the dataset
head(dataBirds)
```

## Data exploration

# Repartition of the data through time

```{r}
# Number of 0 and 1 in the response variable
table(dataBirds$Nest_Fate)
```

We have approximately 66/34% repartition which is good enough to extract
variance from the dataset

```{r}
#Cleveland plot
dotchart(dataBirds$Initiation_Date,pch=16,col='dodgerblue3',xlab='Initiation_Date')
dotchart(dataBirds$Nest_End_Date,pch=16,col='dodgerblue3',xlab='Nest_End_Date')

#Histogram
hist(dataBirds$Initiation_Date,col='dodgerblue3',xlab="Initiation_Date",main="")
hist(dataBirds$Nest_End_Date,col='dodgerblue3',xlab="Nest_End_Date",main="")

# Quantile-Quantile plot
qqnorm(dataBirds$Initiation_Date,pch=16,col='dodgerblue3',xlab='Initiation_Date')
qqline(dataBirds$Initiation_Date,col='red',lwd=2)
qqnorm(dataBirds$Nest_End_Date,pch=16,col='dodgerblue3',xlab='Nest_End_Date')
qqline(dataBirds$Nest_End_Date,col='red',lwd=2)
```

```{r}
# Analyse par variables qualitatives du nombres de modalites et du nombre d'individus par modalite

summary(dataBirds$State)
summary(dataBirds$County)
summary(dataBirds$Habitat)
summary(dataBirds$Species)
summary(dataBirds$Year)
summary(dataBirds$Nest_Fate)

```

Repartition plutot inegale des donnees \> pour certaines modalites nous
avons tres/trop peu de donnees

```{r}
#Analyse de relation potentielle entre Number fledged et nos variables explicatives
plot(dataBirds$Number_Fledged~dataBirds$Habitat,pch=16,col='dodgerblue3',xlab='Habitat',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$County,pch=16,col='dodgerblue3',xlab='County',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$Initiation_Date,pch=16,col='dodgerblue3',xlab='Initiation Date',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$Nest_Fate,pch=16,col='dodgerblue3',xlab='Nest fate',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$Nest_End_Date,pch=16,col='dodgerblue3',xlab='Nest end date', ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$State,pch=16,col='dodgerblue3',xlab='State',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$Year,pch=16,col='dodgerblue3',xlab='Year',ylab='Number Fledged')
plot(dataBirds$Number_Fledged~dataBirds$Species,pch=16,col='dodgerblue3',xlab='Species',ylab='Number Fledged')

```

Interpretation \> Habitat \> Globablement ils se valent tous mais
potentiellement dans les prairies le nombre de fledged est plus faible
County \> Forte dissimilarite en fonction des county \> potentiellement
explicatif ? Initiation date et End date \> tres homogene meme si leger
cone \> donc vers le milieu de la saison peut etre un avantage State \>
Pas de difference significative entre les states Year \> Certaines
annees c est l hecatombe \> forte variabilite par an \> facteur
aleatoire ? Species \> Disparite en fonction des especes mais pas de
reelle difference significative



```{r}

# Analyse colinearite entre les variables explicatives

table(dataBirds$Species,dataBirds$Habitat)
table(dataBirds$Species,dataBirds$County)
table(dataBirds$Species,dataBirds$Year)

boxplot(dataBirds$Initiation_Date~dataBirds$Species, varwidth = TRUE, ylab = "Initiaition Date", xlab = "Species",col=c('dodgerblue3','darkred'), main = "")
boxplot(dataBirds$Initiation_Date~dataBirds$Year, varwidth = TRUE, ylab = "Initiaition Date", xlab = "Year",col=c('dodgerblue3','darkred'), main = "")

boxplot(dataBirds$Nest_End_Date~dataBirds$Species, varwidth = TRUE, ylab = "Initiaition Date", xlab = "Species",col=c('dodgerblue3','darkred'), main = "")
boxplot(dataBirds$Nest_End_Date~dataBirds$Year, varwidth = TRUE, ylab = "Initiaition Date", xlab = "Year",col=c('dodgerblue3','darkred'), main = "")


```


Analyse :
Pour les Initiation date et les end date en fonction des annees et des especes: On ne note pas de colinearite a vu d'oeil


Construction du modele

```{r}
# Model formulation
mod1<-glm(Number_Fledged~ Year
        + Species
        + Habitat
        + County
        + Initiation_Date
        + Nest_End_Date
        + State
        ,data=dataBirds
        ,family=poisson(link="log"))
# Then we check for significance
drop1(mod1,test="Chi")
```

```{r}
# Construction d un modele plutot complet (pas d intercation)
modcomplet<-glm(Number_Fledged~ Year
        + Species
        + Habitat
        + County
        + Initiation_Date
        + Nest_End_Date
        + State
        ,data=dataBirds
        ,family=poisson(link="log"))

# Reduction de variable
modfinal<-stepAIC(modcomplet,direction="both")

#Analyse du modèle final
drop1(modfinal,test="Chi")
summary(modfinal)

```


```{r}
#Coefficient des modeles
summary(mod1)
summary(modfinal)


```

```{r}
# Pouvoir explicatif

# Estimate of deviance explained
(modfinal$null.deviance-mod1$deviance)/mod1$null.deviance

# Some others estimates of deviance explained - package 'rcompanion'
nagelkerke(mod1)


```

```{r}
#Predictions

plot(fitted(modfinal)~dataBirds$Number_Fledged,col='dodgerblue3',pch=16,ylab="Valeurs estimées par le modèle",xlab="Valeurs observées")
abline(0,1)
```












