---

title: "Exploring data on penguins"
group: "CHOULETTE Klervi, DENIS Manon, DUPORT Maureen, MOTTE Arthur, POYARD Antoine, SESIA Marion, TANGUY Céline"
bibliography: references.
bib execute:
freeze: auto
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    number_sections: yes
    
---

# Introduction
## Study context


This document is a report on the analysis of a dataset on penguins. This dataset contains information on various [variables](#column_name). The dataset was find on kaggle : https://www.kaggle.com/datasets/utkarshx27/penguin-size-clutch-and-blood-isotope-data?select=penguins_raw.csv

This dataset was made from differents articles METTRE BIBLIO. Only 3 different species were studied : Adelie, Chinstrap and Gentoo. The dataset contains 344 observations and 17 variables. The goal of this analysis is to explore the dataset and to identify the main characteristics of the penguins.

This document is a report on the analysis of a dataset on penguins. This dataset contains information on various [variables](#colum-name). This dataset was made from differents articles Selon Gorman et al. [@10.1371/journal.pone.0090081] and Horst et al. [@10.32614/RJ-2022-020]. NE FOCNTIONNE PAS MAIS JE VAIS VOIR PLUS TARD Only 3 different species where studied : Adelie, Chinstrap and Gentoo. The dataset contains 344 observations and 17 variables. The goal of this analysis is to explore the dataset and to identify the main characteristics of the penguins. AJOUTER LES QUESTIONS DE RECHERCHE ET LES ANALYSES FAITES


```{r}
#| message: false
#| warning: false
#| echo: true
#| results: hide

library(factoextra) # for data visualization
library(FactoMineR) # for PCA
library(MASS)       # for model selection
library(tidyverse)  # for data manipulation
library(dplyr)      # for data manipulation
library(ggplot2)    # for data visualization
library(corrplot)   # for correlation test

# On a vraiment besoin d'importer dplyr et ggplot2, alors qu'on a deja importer tidyverse ?


library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggspatial)
library(gridExtra)
library(kableExtra)
```
## Location

Data were collected in Antarctica on Biscoe, Dream and Torgersen Islands. 

```{r}
# Download country data (including Antarctica)
world <- ne_countries(scale = "medium", returnclass = "sf")

# Filter to keep only Antarctica
antarctica <- world[world$continent == "Antarctica", ]

rectangle_coords <- st_as_sfc(st_bbox(c(xmin = -90, xmax = -55, ymin = -75, ymax = -60), crs = st_crs(4326)))

antarctic_proj <- "+proj=laea +lat_0=-90 +datum=WGS84"
# Transform the rectangle into the polar projection system
rectangle_proj <- st_transform(rectangle_coords, crs = antarctic_proj)

# Create the map
gg_antartique = ggplot(data = antarctica) +
    annotate("rect", xmin = -90, xmax = -55, ymin = -75, ymax = -60,
           fill = "blue") +
  geom_sf() +
  coord_sf(crs = "+proj=laea +lat_0=-90 +datum=WGS84") +
 annotate("rect", 
           xmin = st_bbox(rectangle_proj)["xmin"], xmax = st_bbox(rectangle_proj)["xmax"], 
           ymin = st_bbox(rectangle_proj)["ymin"], ymax = st_bbox(rectangle_proj)["ymax"], 
           alpha = 0.2, fill = "blue")+
  theme_minimal() +
  labs(title = "Antarctica map",
       caption = "Data: Natural Earth") +
  annotation_scale(location = "bl", width_hint = 0.5)

antarctic_proj <- "+proj=laea +lat_0=-90 +datum=WGS84"

# Point coordinates in longitude and latitude
point_coords <- data.frame(lon = c(-66.209547, -64, -65), lat = c(-66, -65, -64.8))

# Convert the point into an sf object (longitude/latitude coordinate system WGS84)
point_sf <- st_as_sf(point_coords, coords = c("lon", "lat"), crs = 4326)

# Transform the point into the projected coordinate system of the map
point_proj <- st_transform(point_sf, crs = antarctic_proj)

# Extract the projected coordinates for use in annotate
point_proj_coords <- st_coordinates(point_proj)

# Create a bounding box manually with the coordinates
# Convert the bounding box into an sf object
bbox_sf <- st_as_sfc(st_bbox(c(xmin = -90, xmax = -55, ymin = -75, ymax = -60)))

# Crop the map using the bounding box
antarctica_cropped <- st_crop(antarctica, bbox_sf)

# Create the map
gg_zone_interet = ggplot() +
  geom_sf(data = antarctica_cropped) +
  geom_sf(data = point_proj, color = "blue", size = 1, alpha = 0.8, shape = 19) +

  coord_sf(crs = "+proj=laea +lat_0=-90 +datum=WGS84") +
  theme_minimal() +
  labs(title = "Area of Interest",
       caption = "Data: Natural Earth") +
  annotation_scale(location = "bl", width_hint = 0.5)

grid.arrange(gg_antartique, gg_zone_interet, ncol = 2)

```

## Dataset presentation {#column_name}

**Columns name :**

-   studyName :Sampling expedition from which data were collected, generated, etc.\
-   Sample Number : an integer denoting the continuous numbering sequence for each sample\
-   Species : a character string denoting the penguin species\
-   Region : a character string denoting the region of Palmer LTER sampling grid\
-   Island : a character string denoting the island near Palmer Station where samples were collected\
-   Stage : a character string denoting reproductive stage at sampling\
-   Individual ID : a character string denoting the unique ID for each individual in dataset\
-   Clutch Completion : a character string denoting if the study nest observed with a full clutch, i.e., 2 eggs\
-   Date Egg : a date denoting the date study nest observed with 1 egg (sampled)\
-   Culmen Length : a number denoting the length of the dorsal ridge of a bird's bill (millimeters)\
-   Culmen Depth : a number denoting the depth of the dorsal ridge of a bird's bill (millimeters)\
-   Flipper Length : an integer denoting the length penguin flipper (millimeters)\
-   Body Mass : an integer denoting the penguin body mass (grams)\
-   Sex : a character string denoting the sex of an animal\
-   Delta 15 N : a number denoting the measure of the ratio of stable isotopes 15N:14N\
-   Delta 13 C : a number denoting the measure of the ratio of stable isotopes 13C:12C\
-   Comments : a character string with text providing additional relevant information for data

Loading dataset :
```{r}
data <- read.table("penguins_raw.csv", sep = "," , header = TRUE, stringsAsFactors = T)
summary(data)
# dim(data)
```

Modification of colnames :
```{r}
data <- data %>%
  select(-X) %>%                   # Remove X column 
  select(-Comments) %>%           # Remove (?)
  rename(                          # we rename the columns of the dataset
    sample_number = Sample.Number,
    id = Individual.ID,
    island = Island,
    region = Region,
    stage = Stage,
    clutch_completion = Clutch.Completion,
    date_egg = Date.Egg,
    culmen_length = Culmen.Length..mm.,
    culmen_depth = Culmen.Depth..mm.,
    flipper_length = Flipper.Length..mm.,
    body_mass = Body.Mass..g.,
    sex = Sex,
    delta_15_N = Delta.15.N..o.oo.,
    delta_13_C = Delta.13.C..o.oo.,
    species = Species)

names(data)

```

## Missing values :
```{r NA}
# Verification of missing values
colSums(is.na(data)) 

# Removing "Comments" because not relevant for missing values
data_NA <- data %>%
  select(-"Comments")

# Representation of missing values
NA_df <- (colSums(is.na(data_NA)) / nrow(data_NA)) * 100

color_pal <- colorRampPalette(c("limegreen", "yellow", "firebrick"), bias = 20)(10)
NA_col <- color_pal[as.integer(NA_df/length(NA_df)*9)+1]

# Graphique
barplot(NA_df, main = "NA quantity per column",
        ylab = "NA", col = NA_col, las=2, cex.names=0.4)

NA_mean<-mean(NA_df)
# 0.78% 

abline(h=NA_mean, col = "red", lwd = 2)

```

Change species names :
```{r}
data = data %>%
  mutate(species = recode(species, "Adelie Penguin (Pygoscelis adeliae)" = "Adelie", "Chinstrap penguin (Pygoscelis antarctica)" = "Chinstrap", "Gentoo penguin (Pygoscelis papua)" = "Gentoo"))
```

# Exploratory analysis

Distribution of species between the islands :
```{r}
species_islands <- table(data$island, data$species)
kable(species_islands, "html", escape = F, caption = "Distribution of species between the islands") %>%
  kable_styling(bootstrap_options = c("striped"),
                full_width = F,
                position = "center")
```

Some graphs : 
```{r}
ggplot(data, aes(x = flipper_length, y = body_mass, color = species))+
  geom_point()+
  scale_color_manual(values = c("#B2DF8A","#FDBF6F","#CAB2D6"))+
  theme_classic()
```

```{r}
ggplot(data, aes(x = culmen_length, y = culmen_depth, color = species))+
  geom_point()+
  scale_color_manual(values = c("#B2DF8A","#FDBF6F","#CAB2D6"))+
  theme_classic()
```

```{r, fig.width=10, fig.height=5}
ggplot(data, aes(x = delta_15_N, y = delta_13_C, color = species))+
  geom_point()+
  scale_color_manual(values = c("#B2DF8A","#FDBF6F","#CAB2D6"))+
  theme_bw()+
  facet_grid(~island)
```



### PCA : 


```{r}
# Selection of quantitative data
data_numeric <- select_if(data, is.numeric)

# Remove sample_number 
# The body_mass et the flipper_length are more than 80% correlated, we're deleting flipper_length because it's the data that's most correlated with all the other data.
# names(data_numeric)
data_numeric <- data_numeric %>% select(-c("sample_number","flipper_length"))

# Normalizing data
data_scales <- scale(data_numeric)

# PCA realization
acp_data= PCA(data_scales, graph = F)
summary(acp_data)
```



Histogram of the variance of the factorial axes with the percentage of inertia of each axis. Here, keep 2 dimensions and 78.4% inertia.  
```{r}

#Variance for each component
va_propre = fviz_eig(acp_data, main ="", choice = "variance",
         label_size =50, addlabels = T,
         barfill  = "grey",barcolor = "grey")+
   ylim(c(0,60))
va_propre
```
Determind the absolut contribution of variables to each axis. We can see that 3 variables make a strong contribution to axis 1 (delta_15_N, body_mass and culmen_depth) and 2 to axis 2 (culmen_depth and delta_13_C) (Figure 2). 

```{r,warning=FALSE,message=FALSE, fig.height=2, fig.width=5, fig.align = "center"}
#Contribution of axis variables axis 1 and 2
c1 = fviz_contrib(acp_data,choice = "var",axes =1,
                  fill = "grey",color = "grey")+ labs(title = "Axe 1") #For axe 1
c2 = fviz_contrib(acp_data,choice = "var",axes =2,
                  fill = "grey",color = "grey")+ labs(title = "Axe 2") #For axe 2
grid.arrange(c1,c2, ncol = 2)
```

First graph show the result of PCA on axes 1 and 2. *A priori* clustering by the Species has been performed. Gentoo penguins have a greater mass and a longer culmen. Adelies are lighter and have a depth culmen. Chinstrap penguins are the lightest and have a long, depth culmen. Adelies and Chinstrap penguins both have a high concentration of carbon 13 and nitrogen 15.  

```{r,warning=FALSE,message=FALSE, fig.height=7, fig.width=12, fig.align = "center"}
#Projection of variables and individuals and differentiation according to species
bi_plot = fviz_pca_biplot(acp_data, label="var", 
                habillage=data$species, 
                addEllipses = T,
                ellipse.alpha = F,
                title = "Projection of variables and individuals according to species", 
                ylim=c(-3,3.5), xlim = c(-3.5,3.5))+
  scale_color_manual(values = c("#B2DF8A","#FDBF6F","#CAB2D6"))+
  theme_minimal()+
  theme(legend.position = "bottom")

```



```{r}
grid.arrange(bi_plot, va_propre, c1, c2,  #names of graphs
             ncol = 2, nrow = 3, #How many row and col
             widths = c(2.2,1), #Here, the first col will be bigger than the second
             layout_matrix = cbind(c(1,1,1), #On the first col only graph 1 for the 3 rows
                                   c(2,3,4))) #On the second col, the 3 other graphs
```

Second graph show the result of PCA on axes 1 and 2. *A priori* clustering by the Island has been performed. We can see that Gentoo penguins live only on Biscoe Island, while Chinstrap penguins live mainly on Dream Island. Adelie penguins live on these two islands and also on Togersen Island.

The common habitats of Chinstrap and Adelie penguins seem to explain the presence of isotopes in these two species, as they must find a similar diet. 

```{r,warning=FALSE,message=FALSE, fig.height=7, fig.width=12, fig.align = "center"}
#Projection of variables and individuals and differentiation according to species
bi_plot = fviz_pca_biplot(acp_data, label="var",
                          habillage=data$island,
                          addEllipses = T,
                          ellipse.alpha = F,
                          title = "Projection of variables and individuals and dfferentiation according to the islands", 
                          ylim=c(-3,3.5),xlim = c(-3.5,3.5))+
  scale_color_manual(values = c("#B2DF8A","#FDBF6F","#CAB2D6"))+
  theme_minimal()+
  theme(legend.position = "bottom")
grid.arrange(bi_plot, va_propre, c1, c2,  #names of graphs
             ncol = 2, nrow = 3, #How many row and col
             widths = c(2.2,1), #Here, the first col will be bigger than the second
             layout_matrix = cbind(c(1,1,1), #On the first col only graph 1 for the 3 rows
                                   c(2,3,4))) #On the second col, the 3 other graphs
```


```{r}
NA_df <- (colSums(is.na(data)) / nrow(data)) * 100

color_pal <- colorRampPalette(c("limegreen", "yellow", "firebrick"), bias = 20)(10)
NA_col <- color_pal[as.integer(NA_df/length(NA_df)*9)+1]

# Graphique
barplot(NA_df, main = "NA quantity per column",
        ylab = "NA", col = NA_col, las=2, cex.names=0.4)

NA_mean<-mean(NA_df)
# 0.78% 

abline(h=NA_mean, col = "red", lwd = 2)

```


## Violin plot :

```{r violin}

# Violin plot for Culmen Length (beak length)
ggplot(data, aes(x = species, y = culmen_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Culmen Length by Species",
       x = "Species",
       y = "Culmen Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Flipper Length
ggplot(data, aes(x = species, y = flipper_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Flipper Length by Species",
       x = "Species",
       y = "Flipper Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Body Mass
ggplot(data, aes(x = species, y = body_mass, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Body Mass by Species",
       x = "Species",
       y = "Body Mass (g)") +
  theme_minimal() +
  theme(legend.position = "none")

```


In this Data set, we would like to compare the different qualitative variables :\
- *Culmen Length*\
- *Culmen Depth*\
- *Flipper Length*\
- *Body Mass*\
- *Delta 13C*\
- *Delta 15N*\

```{r}
sub_data_num = data%>%
  select(culmen_length, culmen_depth,flipper_length,body_mass,delta_13_C,delta_15_N)%>%
  na.omit() # we delete the few individuals with NA

matcor = cor(sub_data_num,method = "pearson")
matcor
```

The representation of this matrix isn't the best. We can use the library *corrplot* to make some visual correlation matrix.

We used the following code:

```{r}
library(corrplot)

corrplot(matcor, method = "number", type = "upper",order = "hclust", tl.col="black", tl.srt=45)
corrplot(matcor, type = "upper",order = "hclust", tl.col="black", tl.srt=45)

```

Now, we want to observe whether certain qualitative variables have an effect on body mass. We will therefore try to create a graph for each factor (qualitative variables) according to body mass:\
- *Species*\
- *Island*\
- *Sex*\

```{r}
box1 <- ggplot(data = data)+
  geom_boxplot(aes(x=species,y=body_mass, fill = species))
box1

box2 <- ggplot(data = data)+
  geom_boxplot(aes(x=island,y=body_mass, fill = island))
box2

box3 <- ggplot(data = data)+
  geom_boxplot(aes(x=sex,y=body_mass, fill = sex))
box3
```

We have noticed some trends that we will have to confirm with statistical tests.\
Box1: Gentoo penguins appear to be heavier than the other two species.\
Box2: Penguins from Biscoe Island appear to be heavier than the other two islands.\
Box3: Male penguins appear to be heavier than the other two categories.\
We run anovas to confirm these differences.\

```{r}
mod1= lm(body_mass~species, data = data)

anova1 = anova(mod1)

anova1

mod2 = lm(body_mass~island, data = data)

anova2 = anova(mod2)

anova2

mod3 = lm(body_mass~sex, data = data)

anova3 = anova(mod3)

anova3
```

Significance tests confirm the trends seen by the eye.

# Body mass model

The aim of this part is to determine which variable influence the penguins' body mass.
```{r data preparation}
#selection of the interesting variables
dataLM<-data %>% 
  select(species,island,clutch_completion,culmen_length,culmen_depth,flipper_length,body_mass,sex,delta_15_N,delta_13_C)

#set the variable type (factors or numerics)
dataLM$species<-as.factor(dataLM$species)
dataLM$island<-as.factor(dataLM$island)
dataLM$clutch_completion<-as.factor(dataLM$clutch_completion)
dataLM$sex<-as.factor(dataLM$sex)
dataLM$flipper_length<-as.numeric(dataLM$flipper_length)
dataLM$body_mass<-as.numeric(dataLM$body_mass)

str(dataLM)

#check if there is missing values 
colSums(is.na(dataLM))

#delete individual with missing values
dataLM<-dataLM %>% 
  drop_na(culmen_length,culmen_depth,flipper_length,body_mass,sex,delta_15_N,delta_13_C)

summary(dataLM)
```
## Exploration of the data 
We begin the analysis by exploring the data and looking for aberrant values.
First we look at the response variable: body mass
```{r body mass, include=TRUE, fig.height=6, fig.width=6}
par(mfrow=c(2,2))
# Boxplot
boxplot(dataLM$body_mass,col='dodgerblue3',ylab='body mass')
# Cleveland plot
dotchart(dataLM$body_mass,pch=16,col='dodgerblue3',xlab='body mass')
# Histogram
hist(dataLM$body_mass,col='dodgerblue3',xlab="body mass",main="")
# Quantile-Quantile plot
qqnorm(dataLM$body_mass,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$body_mass,col='red',lwd=2)
```
There is no aberrant values for the variable body mass.

Than we look at the quantitative explanatory variables.
```{r covariable, include=TRUE, fig.height=12, fig.width=9}
par(mfrow=c(5,3))

# Culmen Length
# Cleveland plot
dotchart(dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='culmen_length')
# Histogram
hist(dataLM$culmen_length,col='dodgerblue3',xlab="culmen_length",main="")
# Quantile-Quantile plot
qqnorm(dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$culmen_length,col='red',lwd=2)

# Culmen Depth
# Cleveland plot
dotchart(dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='culmen_depth')
# Histogram
hist(dataLM$culmen_depth,col='dodgerblue3',xlab="culmen_depth",main="")
# Quantile-Quantile plot
qqnorm(dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$culmen_depth,col='red',lwd=2)

# Flipper length
# Cleveland plot
dotchart(dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='flipper length')
# Histogram
hist(dataLM$flipper_length,col='dodgerblue3',xlab="flipper length",main="")
# Quantile-Quantile plot
qqnorm(dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$flipper_length,col='red',lwd=2)

# Delta_15_N
# Cleveland plot
dotchart(dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='delta_15_N')
# Histogram
hist(dataLM$delta_15_N,col='dodgerblue3',xlab="delta_15_N",main="")
# Quantile-Quantile plot
qqnorm(dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$delta_15_N,col='red',lwd=2)

# Delta_13_C
# Cleveland plot
dotchart(dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='delta_13_C')
# Histogram
hist(dataLM$delta_13_C,col='dodgerblue3',xlab="delta_13_C",main="")
# Quantile-Quantile plot
qqnorm(dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$delta_13_C,col='red',lwd=2)
```
There is no aberrant values for the quantitative explanatory variable.

Finally we look at the qualitativ explanatory variables.
```{r cofactors, include=TRUE}
# Factor Sex
summary(dataLM$sex)
# Factor Island
summary(dataLM$island)
# Factor Species
summary(dataLM$species)
# Factor Clutch completion
summary(dataLM$clutch_completion)
```
We observe that the plan is non orthogonal. 

Secondly, we explore the dynamics between body mass and the explanatory variable, to see if there is some trend. 
```{r datagraph, include=TRUE, fig.height=15, fig.width=6}
par(mfrow=c(5,2))
# Culmen length
plot(dataLM$body_mass~dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='culmen length',ylab='body mass')
# Culmen depth
plot(dataLM$body_mass~dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='culmen depth',ylab='body mass')
# Flipper length
plot(dataLM$body_mass~dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='flipper length',ylab='body mass')
# delta 15 N
plot(dataLM$body_mass~dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='delta 15N',ylab='body mass')
# delta 13 C
plot(dataLM$body_mass~dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='delta 13C',ylab='body mass')
#Species
boxplot(dataLM$body_mass~dataLM$species, varwidth = TRUE, ylab = "body mass", xlab = "Species", col='darkgrey', main = "")
#Island
boxplot(dataLM$body_mass~dataLM$island, varwidth = TRUE, ylab = "body mass", xlab = "Island", col='brown', main = "")
#Clutch completion
boxplot(dataLM$body_mass~dataLM$clutch_completion, varwidth = TRUE, ylab = "body mass", xlab = "Clutch completion", col='brown', main = "")
#Sex
boxplot(dataLM$body_mass~dataLM$sex, varwidth = TRUE, ylab = "body mass", xlab = "Sex", col='brown', main = "")
```

The variables that seems to influence body mass are culmen length, flipper length, delta 15N, species and island. 

Finally we check if there is colinearity between some variable.
First, between covariables.
```{r colinearity covariables, include=TRUE, fig.height=5, fig.width=5}
# Checking collinearity between continuous independent variables
# We represent plot for each X continuous covariate pair.
plot(dataLM %>% select_if(is.numeric) %>% select(-body_mass),pch=16,col='dodgerblue3')
#We calculate correlation between each pair of X covariate
corrplot.mixed(cor(dataLM %>% select_if(is.numeric)%>% select(-body_mass)),upper="square",lower.col="black", tl.col="black",cl.cex = 0.8,tl.cex = 0.7,number.cex =0.8)
M<-dataLM %>% select_if(is.numeric) %>% select(-body_mass)
```
We chose the threshold at 0.7 so there is no colinearity detected between the covariables.

Then, between cofactors. In order to do so, we plot all the covariable as a function of all cofactors.
```{r colinearity cofactors,include=TRUE, fig.height=15, fig.width=12}
# Checking collinearity between cofactors and covariables
par(mfrow=c(5,4))
#Culmen length and species
boxplot(dataLM$culmen_length~dataLM$species, varwidth = TRUE, ylab = "Culmen length", xlab = "Species", col='grey', main = "")
#Culmen length and island
boxplot(dataLM$culmen_length~dataLM$island, varwidth = TRUE, ylab = "Culmen length", xlab = "Island", col='grey', main = "")
#Culmen length and sex
boxplot(dataLM$culmen_length~dataLM$sex, varwidth = TRUE, ylab = "Culmen length", xlab = "Sex", col='grey', main = "")
#Culmen length and clutch completion
boxplot(dataLM$culmen_length~dataLM$clutch_completion, varwidth = TRUE, ylab = "Culmen length", xlab = "Clutch completion", col='grey', main = "")

#Culmen depth and species
boxplot(dataLM$culmen_depth~dataLM$species, varwidth = TRUE, ylab = "Culmen depth", xlab = "Species", col='grey', main = "")
#Culmen depth and island
boxplot(dataLM$culmen_depth~dataLM$island, varwidth = TRUE, ylab = "Culmen depth", xlab = "Island", col='grey', main = "")
#Culmen depth and sex
boxplot(dataLM$culmen_depth~dataLM$sex, varwidth = TRUE, ylab = "Culmen depth", xlab = "Sex", col='grey', main = "")
#Culmen depth and clutch completion
boxplot(dataLM$culmen_depth~dataLM$clutch_completion, varwidth = TRUE, ylab = "Culmen depth", xlab = "Clutch completion", col='grey', main = "")

#Flipper length and species
boxplot(dataLM$flipper_length~dataLM$species, varwidth = TRUE, ylab = "Flipper length", xlab = "Species", col='grey', main = "")
#Flipper length and island
boxplot(dataLM$flipper_length~dataLM$island, varwidth = TRUE, ylab = "Flipper length", xlab = "Island", col='grey', main = "")
#Flipper length and sex
boxplot(dataLM$flipper_length~dataLM$sex, varwidth = TRUE, ylab = "Flipper length", xlab = "Sex", col='grey', main = "")
#Flipper length and clutch completion
boxplot(dataLM$flipper_length~dataLM$clutch_completion, varwidth = TRUE, ylab = "Flipper length", xlab = "Clutch completion", col='grey', main = "")

#delta 15N and species
boxplot(dataLM$delta_15_N~dataLM$species, varwidth = TRUE, ylab = "delta 15N", xlab = "Species", col='grey', main = "")
#delta 15N and island
boxplot(dataLM$delta_15_N~dataLM$island, varwidth = TRUE, ylab = "delta 15N", xlab = "Island", col='grey', main = "")
#delta 15N and sex
boxplot(dataLM$delta_15_N~dataLM$sex, varwidth = TRUE, ylab = "delta 15N", xlab = "Sex", col='grey', main = "")
#delta 15N and clutch completion
boxplot(dataLM$delta_15_N~dataLM$clutch_completion, varwidth = TRUE, ylab = "delta 15N", xlab = "Clutch completion", col='grey', main = "")

#delta 13C and species
boxplot(dataLM$delta_13_C~dataLM$species, varwidth = TRUE, ylab = "delta 13C", xlab = "Species", col='grey', main = "")
#delta 13C and island
boxplot(dataLM$delta_13_C~dataLM$island, varwidth = TRUE, ylab = "delta 13C", xlab = "Island", col='grey', main = "")
#delta 13C and sex
boxplot(dataLM$delta_13_C~dataLM$sex, varwidth = TRUE, ylab = "delta 13C", xlab = "Sex", col='grey', main = "")
#delta 13C and clutch completion
boxplot(dataLM$delta_13_C~dataLM$clutch_completion, varwidth = TRUE, ylab = "delta 13C", xlab = "Clutch completion", col='grey', main = "")

```

## Statistics analysis - Model selection

We build the statistical model, including all explanatory variable at first.
```{r full model}
modlm<-lm(body_mass ~ species + island + clutch_completion + culmen_length + culmen_depth + flipper_length + sex + delta_15_N + delta_13_C,data=dataLM) #full model
```

Now we are going to select the best model "by hand"
```{r full model}
drop1(modlm,test="F") #test significativté des variables avec test fischer
```
We exclude the variable "island" of the model, because it is the non-significant variable with the highest p-value.
Then, we create a new model (without the variable "island") and test for significance.
```{r model2}
modlm2<-lm(body_mass ~ species + clutch_completion + culmen_length + 
    culmen_depth + flipper_length + sex + delta_15_N + delta_13_C, data=dataLM)
drop1(modlm2,test="F")
```
As previously, we exclude the variable "clutch_completion" of the model, because it is non-significant.
We build a new model and test again for variables' significance.

```{r model3}
modlm3<-lm(body_mass ~ species + culmen_length + 
    culmen_depth + flipper_length + sex + delta_15_N + delta_13_C, data=dataLM)
drop1(modlm3,test="F")
```
All the variable in the model are significant, so we keep all of them in our final model. The best model is thus: body_mass ~ species + culmen_length + culmen_depth + flipper_length + sex + delta_15_N + delta_13_C

```{r}
summary(modlm3)
```

An other way to select the best model is with the AIC criterion.
```{r model selection AIC}
modfinal<-stepAIC(modlm,direction="both")
summary(modfinal)
```
With this method, the best model is the same one than previously with the variable "clutch completion" in addition.
However, it's not significant so it confirms our first model selection.

Finally, the model can be written as:

$$ Body\:Mass = 1467.1\:+\:(Species_{Adeliae} = 0 \:;\:Species_{Pygoscelis antarctica} = -245.1^{**}\:;\:Species_{Pygoscelis papua} = 882.1^{***})$$
$$ +\:17.1^{*NS*}. Culmen\:Length\:+\:61.6^{**}. Culmen\:Depth\:+\:17.8^{***}. Flipper\:Length $$
$$ + (Sex_{Female}= 0\:;\: Sex_{Male}=417.9^{***})\:-\:164.3^{***}. Delta\:15N\:+\:65.2^{*}. Delta\:13C)$$

We can also notice that the model explain 88% of the body mass variance.

## Model validation
We need the validation of the model. Because it is a linear model, we need independence of the variable, normality and homoscedasticity of residuals.

Here, we assume an independence of variables as we don't have the details of the data collection. 

We check the normality of residuals.
```{r ResidNorm, include=TRUE, fig.height=3, fig.width=6}
par(mfrow=c(1,2))
# Histogram
hist(modlm3$residuals,col='dodgerblue3',xlab="residuals",main="Check Normality")
# Quantile-Quantile plot
qqnorm(modlm3$residuals,pch=16,col='dodgerblue3',xlab='')
qqline(modlm3$residuals,col='red',lwd=2)
```
Residuals have a normal distribution.

We check the homoscedasticity of residuals.
```{r Residhomo, include=TRUE, fig.height=5, fig.width=5}
# residuals vs fitted
plot(residuals(modlm3)~fitted(modlm3)
      , col='dodgerblue3'
      , pch=16)
abline(h = 0)

```
The variance is homogeneous.

We also verify that there isn't an individual that is particularly influential. 
```{r Contri, include=TRUE, fig.height=4, fig.width=4}

par(mfrow = c(1, 1))
plot(cooks.distance(modlm3), type = "h", ylim = c(0, 1))
abline(h = 1, col = 2,lwd = 3)

```
As all the bar are lower that 1, there is no influential individual.

We can conclude that the linear model is valid.

