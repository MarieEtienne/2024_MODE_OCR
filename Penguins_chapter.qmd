---
Title: "Exploring data on penguins"\
Group: "CHOULETTE Klervi, DENIS Manon, DUPORT Maureen, MOTTE Arthur, POYARD Antoine, SESIA Marion, TANGUY CÃ©line"\
Bibliography: references.\
bib execute: \
freeze: auto \
output: \
html_document: \
toc: true \
toc_float: true \
editor: \
markdown: \
wrap: 72\
---

## Study context

This document is a report on the analysis of a dataset on penguins. This dataset contains information on various [variables](#column_name). The dataset was find on kaggle : https://www.kaggle.com/datasets/utkarshx27/penguin-size-clutch-and-blood-isotope-data?select=penguins_raw.csv

This dataset was made from differents articles METTRE BIBLIO. Only 3 different species were studied : Adelie, Chinstrap and Gentoo. The dataset contains 344 observations and 17 variables. The goal of this analysis is to explore the dataset and to identify the main characteristics of the penguins.

This document is a report on the analysis of a dataset on penguins. This dataset contains information on various [variables](#colum-name). This dataset was made from differents articles Selon Gorman et al. [@10.1371/journal.pone.0090081] and Horst et al. [@10.32614/RJ-2022-020]. NE FOCNTIONNE PAS MAIS JE VAIS VOIR PLUS TARD Only 3 different species where studied : Adelie, Chinstrap and Gentoo. The dataset contains 344 observations and 17 variables. The goal of this analysis is to explore the dataset and to identify the main characteristics of the penguins. AJOUTER LES QUESTIONS DE RECHERCHE ET LES ANALYSES FAITES


```{r}
#| message: false
#| warning: false
#| echo: true
#| results: hide

library(factoextra) # for data visualization
library(FactoMineR) # for PCA
library(tidyverse)  # for data manipulation
library(dplyr)      # for data manipulation
library(ggplot2)    # for data visualization

# On a vraiment besoin d'importer dplyr et ggplot2, alors qu'on a deja importer tidyverse ?
```

## Dataset presentation {#column_name}:

**Columns name :**

-   studyName :Sampling expedition from which data were collected, generated, etc.\
-   Sample Number : an integer denoting the continuous numbering sequence for each sample\
-   Species : a character string denoting the penguin species\
-   Region : a character string denoting the region of Palmer LTER sampling grid\
-   Island : a character string denoting the island near Palmer Station where samples were collected\
-   Stage : a character string denoting reproductive stage at sampling\
-   Individual ID : a character string denoting the unique ID for each individual in dataset\
-   Clutch Completion : a character string denoting if the study nest observed with a full clutch, i.e., 2 eggs\
-   Date Egg : a date denoting the date study nest observed with 1 egg (sampled)\
-   Culmen Length : a number denoting the length of the dorsal ridge of a bird's bill (millimeters)\
-   Culmen Depth : a number denoting the depth of the dorsal ridge of a bird's bill (millimeters)\
-   Flipper Length : an integer denoting the length penguin flipper (millimeters)\
-   Body Mass : an integer denoting the penguin body mass (grams)\
-   Sex : a character string denoting the sex of an animal\
-   Delta 15 N : a number denoting the measure of the ratio of stable isotopes 15N:14N\
-   Delta 13 C : a number denoting the measure of the ratio of stable isotopes 13C:12C\
-   Comments : a character string with text providing additional relevant information for data

```{r}
data <- read.table("penguins_raw.csv", sep = "," , header = TRUE, stringsAsFactors = T)
summary(data)
# dim(data)
```

```{r}

# Modification of colnames 
data <- data %>%
  select(-X) %>%                   # Remove X column 
  select(-Comments) %>%           # Remove (?)
  rename(                          # we rename the columns of the dataset
    sample_number = Sample.Number,
    id = Individual.ID,
    island = Island,
    region = Region,
    stage = Stage,
    clutch_completion = Clutch.Completion,
    date_egg = Date.Egg,
    culmen_length = Culmen.Length..mm.,
    culmen_depth = Culmen.Depth..mm.,
    flipper_length = Flipper.Length..mm.,
    body_mass = Body.Mass..g.,
    sex = Sex,
    delta_15_N = Delta.15.N..o.oo.,
    delta_13_C = Delta.13.C..o.oo.,
    species = Species,
  ) 

names(data)
# Verification of missing data
colSums(is.na(data)) 

```

Change species names :

```{r}
data = data %>%
  mutate(species = recode(species, "Adelie Penguin (Pygoscelis adeliae)" = "Adelie", "Chinstrap penguin (Pygoscelis antarctica)" = "Chinstrap", "Gentoo penguin (Pygoscelis papua)" = "Gentoo"))
```

Distribution of species between the islands :

```{r}
table(data$island, data$species)
```

Some graphs :

```{r}
ggplot(data, aes(x = flipper_length, y = body_mass, color = species))+
  geom_point()+
  theme_classic()
```

```{r}
ggplot(data, aes(x = culmen_length, y = culmen_depth, color = species))+
  geom_point()+
  theme_classic()
```

```{r}
ggplot(data, aes(x = delta_15_N, y = delta_13_C, color = species, shape = island))+
  geom_point()+
  theme_classic()
```




```{r}
#Selection of quantitative data
data_numeric <- select_if(data, is.numeric)

# Remove sample_number 
# The body_mass et the flipper_length are more than 80% correlated, we're deleting flipper_length because it's the data that's most correlated with all the other data.
# names(data_numeric)
data_numeric <- data_numeric %>% select(-c("sample_number","flipper_length"))

# Normalizing data
data_scales <- scale(data_numeric)

#PCA realization
acp_data= PCA(data_scales, graph = F)
summary(acp_data)

#Correlation circle
fviz_pca_var(acp_data)

#Variance for each component
fviz_eig(acp_data)

#Contribution of axis variables axis 1 and 2
fviz_contrib(acp_data, choice="var", axes=1) #axe 1
fviz_contrib(acp_data, choice="var", axes=2) #axe 1

# Projection of individuals and differentiation according to species
fviz_pca_ind(acp_data, geom.ind = "point", habillage = data$species, addEllipses = T, pointshape = 19)

#Projection of variables and individuals and differentiation according to species
fviz_pca_biplot(acp_data, label="var", habillage=data$species, title = "Projection of variables and individuals according to species", ylim=c(-3,3.5), xlim = c(-3.5,3.5))

# Projection of individuals and differentiation according to the islands
fviz_pca_ind(acp_data, geom.ind = "point", habillage = data$island, addEllipses = T, pointshape = 19)
#Projection of variables and individuals and differentiation according to the islands
fviz_pca_biplot(acp_data, label="var", habillage=data$island, title = "Projection of variables and individuals and dfferentiation according to the islands", ylim=c(-3,3.5),xlim = c(-3.5,3.5))

```

```{r NA}
NA_df <- (colSums(is.na(data)) / nrow(data)) * 100

color_pal <- colorRampPalette(c("limegreen", "yellow", "firebrick"), bias = 20)(10)
NA_col <- color_pal[as.integer(NA_df/length(NA_df)*9)+1]

# Graphique
barplot(NA_df, main = "NA quantity per column",
        ylab = "NA", col = NA_col, las=2, cex.names=0.4)

NA_mean<-mean(NA_df)
# 0.78% 

abline(h=NA_mean, col = "red", lwd = 2)

```

```{r violin}

# Violin plot for Culmen Length (beak length)
ggplot(data, aes(x = species, y = culmen_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Culmen Length by Species",
       x = "Species",
       y = "Culmen Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Flipper Length
ggplot(data, aes(x = species, y = flipper_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Flipper Length by Species",
       x = "Species",
       y = "Flipper Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Body Mass
ggplot(data, aes(x = species, y = body_mass, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Body Mass by Species",
       x = "Species",
       y = "Body Mass (g)") +
  theme_minimal() +
  theme(legend.position = "none")

```

In this Data set, we would like to compare the different qualitative variables :\
- *Culmen Length*\
- *Culmen Depth*\
- *Flipper Length*\
- *Body Mass*\
- *Delta 13C*\
- *Delta 15N*\

```{r}
sub_data_num = data%>%
  select(culmen_length, culmen_depth,flipper_length,body_mass,delta_13_C,delta_15_N)%>%
  na.omit() # we delete the few individuals with NA

matcor = cor(sub_data_num,method = "pearson")
matcor
```

The representation of this matrix isn't the best. We can use the library *corrplot* to make some visual correlation matrix.

We used the following code:

```{r}
library(corrplot)

corrplot(matcor, method = "number", type = "upper",order = "hclust", tl.col="black", tl.srt=45)
corrplot(matcor, type = "upper",order = "hclust", tl.col="black", tl.srt=45)

```

Now, we want to observe whether certain qualitative variables have an effect on body mass. We will therefore try to create a graph for each factor (qualitative variables) according to body mass:\
- *Species*\
- *Island*\
- *Sex*\

```{r}
box1 <- ggplot(data = data)+
  geom_boxplot(aes(x=species,y=body_mass, fill = species))
box1

box2 <- ggplot(data = data)+
  geom_boxplot(aes(x=island,y=body_mass, fill = island))
box2

box3 <- ggplot(data = data)+
  geom_boxplot(aes(x=sex,y=body_mass, fill = sex))
box3
```

We have noticed some trends that we will have to confirm with statistical tests.\
Box1: Gentoo penguins appear to be heavier than the other two species.\
Box2: penguins from Biscoe Island appear to be heavier than the other two islands.\
Box3: male penguins appear to be heavier than the other two categories.\
We run anovas to confirm these differences.\

```{r}
mod1= lm(body_mass~species, data = data)

anova1 = anova(mod1)

anova1

mod2 = lm(body_mass~island, data = data)

anova2 = anova(mod2)

anova2

mod3 = lm(body_mass~sex, data = data)

anova3 = anova(mod3)

anova3
```

Significance tests confirm the trends seen by the eye.

# Which parameters influence the body mass
The aim of this part is to determine wich variable influence the body mass of the penguins.
```{r data preparation}
#selection of the interesting varaibles
dataLM<-data %>% 
  select(species,island,clutch_completion,culmen_length,culmen_depth,flipper_length,body_mass,sex,delta_15_N,delta_13_C)

dataLM$species<-as.factor(dataLM$species)
dataLM$island<-as.factor(dataLM$island)
dataLM$clutch_completion<-as.factor(dataLM$clutch_completion)
dataLM$sex<-as.factor(dataLM$sex)
dataLM$flipper_length<-as.numeric(dataLM$flipper_length)
dataLM$body_mass<-as.numeric(dataLM$body_mass)

str(dataLM)
  
colSums(is.na(dataLM))

#delete individual with missing values
dataLM<-dataLM %>% 
  drop_na(culmen_length,culmen_depth,flipper_length,body_mass,sex,delta_15_N,delta_13_C)

summary(dataLM)
```
## Exploration of the data - abberant values

```{r body mass, include=TRUE, fig.height=6, fig.width=6}
par(mfrow=c(2,2))
# Boxplot
boxplot(dataLM$body_mass,col='dodgerblue3',ylab='body mass')
# Cleveland plot
dotchart(dataLM$body_mass,pch=16,col='dodgerblue3',xlab='body mass')
# Histogram
hist(dataLM$body_mass,col='dodgerblue3',xlab="body mass",main="")
# Quantile-Quantile plot
qqnorm(dataLM$body_mass,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$body_mass,col='red',lwd=2)
```
There is no abberant values for the variable body mass.

```{r covariable, include=TRUE, fig.height=12, fig.width=9}
par(mfrow=c(5,3))

# Culmen Length
# Cleveland plot
dotchart(dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='culmen_length')
# Histogram
hist(dataLM$culmen_length,col='dodgerblue3',xlab="culmen_length",main="")
# Quantile-Quantile plot
qqnorm(dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$culmen_length,col='red',lwd=2)

# Culmen Depth
# Cleveland plot
dotchart(dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='culmen_depth')
# Histogram
hist(dataLM$culmen_depth,col='dodgerblue3',xlab="culmen_depth",main="")
# Quantile-Quantile plot
qqnorm(dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$culmen_depth,col='red',lwd=2)

# Flipper length
# Cleveland plot
dotchart(dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='flipper length')
# Histogram
hist(dataLM$flipper_length,col='dodgerblue3',xlab="flipper length",main="")
# Quantile-Quantile plot
qqnorm(dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$flipper_length,col='red',lwd=2)

# Delta_15_N
# Cleveland plot
dotchart(dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='delta_15_N')
# Histogram
hist(dataLM$delta_15_N,col='dodgerblue3',xlab="delta_15_N",main="")
# Quantile-Quantile plot
qqnorm(dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$delta_15_N,col='red',lwd=2)

# Delta_13_C
# Cleveland plot
dotchart(dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='delta_13_C')
# Histogram
hist(dataLM$delta_13_C,col='dodgerblue3',xlab="delta_13_C",main="")
# Quantile-Quantile plot
qqnorm(dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='')
qqline(dataLM$delta_13_C,col='red',lwd=2)
```
There is no abberant values for the quantitativ explanatory variable


```{r cofactors, include=TRUE}
# Factor Sex
summary(dataLM$sex)
# Factor Island
summary(dataLM$island)
# Factor Species
summary(dataLM$species)
# Factor Clutch completion
summary(dataLM$clutch_completion)
```
Plan non orthogonale

```{r datagraph, include=TRUE, fig.height=15, fig.width=6}
par(mfrow=c(5,2))
# Culmen length
plot(dataLM$body_mass~dataLM$culmen_length,pch=16,col='dodgerblue3',xlab='culmen length',ylab='body mass')
# Culmen depth
plot(dataLM$body_mass~dataLM$culmen_depth,pch=16,col='dodgerblue3',xlab='culmen depth',ylab='body mass')
# Flipper length
plot(dataLM$body_mass~dataLM$flipper_length,pch=16,col='dodgerblue3',xlab='flipper length',ylab='body mass')
# delta 15 N
plot(dataLM$body_mass~dataLM$delta_15_N,pch=16,col='dodgerblue3',xlab='delta 15N',ylab='body mass')
# delta 13 C
plot(dataLM$body_mass~dataLM$delta_13_C,pch=16,col='dodgerblue3',xlab='delta 13C',ylab='body mass')
#Species
boxplot(dataLM$body_mass~dataLM$species, varwidth = TRUE, ylab = "body mass", xlab = "Species", col='darkgrey', main = "")
#Island
boxplot(dataLM$body_mass~dataLM$island, varwidth = TRUE, ylab = "body mass", xlab = "Island", col='brown', main = "")
#Clutch completion
boxplot(dataLM$body_mass~dataLM$clutch_completion, varwidth = TRUE, ylab = "body mass", xlab = "Clutch completion", col='brown', main = "")
#Sex
boxplot(dataLM$body_mass~dataLM$sex, varwidth = TRUE, ylab = "body mass", xlab = "Sex", col='brown', main = "")
```

Variable that seems to influence body mass: culmne length, flipper length, delta 15N, species and island

```{r colinearity covariables, include=TRUE, fig.height=5, fig.width=5}
# Checking collinearity between continuous independent variables
# We represent plot for each X continuous covariate pair.
plot(dataLM %>% select_if(is.numeric) %>% select(-body_mass),pch=16,col='dodgerblue3')
#We calculate correlation between each pair of X covariate
corrplot.mixed(cor(dataLM %>% select_if(is.numeric)%>% select(-body_mass)),upper="square",lower.col="black", tl.col="black",cl.cex = 0.8,tl.cex = 0.7,number.cex =0.8)
M<-dataLM %>% select_if(is.numeric) %>% select(-body_mass)
```
No colinearity detected between the covariables.

```{r colinearity cofactors,include=TRUE, fig.height=15, fig.width=12}
# Checking collinearity between cofactors and covariables
par(mfrow=c(5,4))
#Culmen length and species
boxplot(dataLM$culmen_length~dataLM$species, varwidth = TRUE, ylab = "Culmen length", xlab = "Species", col='grey', main = "")
#Culmen length and island
boxplot(dataLM$culmen_length~dataLM$island, varwidth = TRUE, ylab = "Culmen length", xlab = "Island", col='grey', main = "")
#Culmen length and sex
boxplot(dataLM$culmen_length~dataLM$sex, varwidth = TRUE, ylab = "Culmen length", xlab = "Sex", col='grey', main = "")
#Culmen length and clutch completion
boxplot(dataLM$culmen_length~dataLM$clutch_completion, varwidth = TRUE, ylab = "Culmen length", xlab = "Clutch completion", col='grey', main = "")

#Culmen depth and species
boxplot(dataLM$culmen_depth~dataLM$species, varwidth = TRUE, ylab = "Culmen depth", xlab = "Species", col='grey', main = "")
#Culmen depth and island
boxplot(dataLM$culmen_depth~dataLM$island, varwidth = TRUE, ylab = "Culmen depth", xlab = "Island", col='grey', main = "")
#Culmen depth and sex
boxplot(dataLM$culmen_depth~dataLM$sex, varwidth = TRUE, ylab = "Culmen depth", xlab = "Sex", col='grey', main = "")
#Culmen depth and clutch completion
boxplot(dataLM$culmen_depth~dataLM$clutch_completion, varwidth = TRUE, ylab = "Culmen depth", xlab = "Clutch completion", col='grey', main = "")

#Flipper length and species
boxplot(dataLM$flipper_length~dataLM$species, varwidth = TRUE, ylab = "Flipper length", xlab = "Species", col='grey', main = "")
#Flipper length and island
boxplot(dataLM$flipper_length~dataLM$island, varwidth = TRUE, ylab = "Flipper length", xlab = "Island", col='grey', main = "")
#Flipper length and sex
boxplot(dataLM$flipper_length~dataLM$sex, varwidth = TRUE, ylab = "Flipper length", xlab = "Sex", col='grey', main = "")
#Flipper length and clutch completion
boxplot(dataLM$flipper_length~dataLM$clutch_completion, varwidth = TRUE, ylab = "Flipper length", xlab = "Clutch completion", col='grey', main = "")

#delta 15N and species
boxplot(dataLM$delta_15_N~dataLM$species, varwidth = TRUE, ylab = "delta 15N", xlab = "Species", col='grey', main = "")
#delta 15N and island
boxplot(dataLM$delta_15_N~dataLM$island, varwidth = TRUE, ylab = "delta 15N", xlab = "Island", col='grey', main = "")
#delta 15N and sex
boxplot(dataLM$delta_15_N~dataLM$sex, varwidth = TRUE, ylab = "delta 15N", xlab = "Sex", col='grey', main = "")
#delta 15N and clutch completion
boxplot(dataLM$delta_15_N~dataLM$clutch_completion, varwidth = TRUE, ylab = "delta 15N", xlab = "Clutch completion", col='grey', main = "")

#delta 13C and species
boxplot(dataLM$delta_13_C~dataLM$species, varwidth = TRUE, ylab = "delta 13C", xlab = "Species", col='grey', main = "")
#delta 13C and island
boxplot(dataLM$delta_13_C~dataLM$island, varwidth = TRUE, ylab = "delta 13C", xlab = "Island", col='grey', main = "")
#delta 13C and sex
boxplot(dataLM$delta_13_C~dataLM$sex, varwidth = TRUE, ylab = "delta 13C", xlab = "Sex", col='grey', main = "")
#delta 13C and clutch completion
boxplot(dataLM$delta_13_C~dataLM$clutch_completion, varwidth = TRUE, ylab = "delta 13C", xlab = "Clutch completion", col='grey', main = "")

```
