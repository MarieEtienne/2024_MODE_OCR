---

title: "Exploring data on penguins"
group: "CHOULETTE Klervi, DENIS Manon, DUPORT Maureen, MOTTE Arthur, POYARD Antoine, SESIA Marion, TANGUY CÃ©line" 

bibliography: references.bib
execute: 
  freeze: auto
output: 
  html_document:
   toc: true
   toc_float: true
---

## Study context

This document is a report on the analysis of a dataset on penguins. This dataset contains information on various [variables](#colum-name). This dataset was made from 4 differents articles METTRE BIBLIO.
Only 3 different species where studied : Adelie, Chinstrap and Gentoo. The dataset contains 344 observations and 17 variables. The goal of this analysis is to explore the dataset and to identify the main characteristics of the penguins.
AJOUTER LES QUESTIONS DE RECHERCHE ET LES ANALYSES FAITES


```{r}
library(factoextra) # for data visualization
library(FactoMineR) # for PCA
library(tidyverse)  # for data manipulation
library(dplyr)      # for data manipulation
library(ggplot2)    # for data visualization

# On a vraiment besoin d'importer dplyr et ggplot2, alors qu'on a deja importer tidyverse ?
```

## Dataset presentation {#colum-name}: 

**Columns name :**

 - studyName :Sampling expedition from which data were collected, generated, etc.  
 - Sample Number : an integer denoting the continuous numbering sequence for each sample  
 - Species : a character string denoting the penguin species  
 - Region : a character string denoting the region of Palmer LTER sampling grid  
 - Island : a character string denoting the island near Palmer Station where samples were collected  
 - Stage : a character string denoting reproductive stage at sampling  
 - Individual ID : a character string denoting the unique ID for each individual in dataset  
 - Clutch Completion : a character string denoting if the study nest observed with a full clutch, i.e., 2 eggs  
 - Date Egg : a date denoting the date study nest observed with 1 egg (sampled)  
 - Culmen Length : a number denoting the length of the dorsal ridge of a bird's bill (millimeters)  
 - Culmen Depth : a number denoting the depth of the dorsal ridge of a bird's bill (millimeters)  
 - Flipper Length : an integer denoting the length penguin flipper (millimeters)  
 - Body Mass : an integer denoting the penguin body mass (grams)  
 - Sex : a character string denoting the sex of an animal  
 - Delta 15 N : a number denoting the measure of the ratio of stable isotopes 15N:14N  
 - Delta 13 C : a number denoting the measure of the ratio of stable isotopes 13C:12C  
 - Comments : a character string with text providing additional relevant information for data  


```{r}
data <- read.table("penguins_raw.csv", sep = "," , header = TRUE, stringsAsFactors = T)
summary(data)
dim(data)
```


```{r Antoine}

# Modification of colnames 
data <- data %>%
  select(-X) %>%                   # Remove X column 
  #select(-Comments) %>%           # Remove (?)
  rename(                          # we rename the columns of the dataset
    sample_number = Sample.Number,
    id = Individual.ID,
    island = Island,
    region = Region,
    stage = Stage,
    clutch_completion = Clutch.Completion,
    date_egg = Date.Egg,
    culmen_length = Culmen.Length..mm.,
    culmen_depth = Culmen.Depth..mm.,
    flipper_length = Flipper.Length..mm.,
    body_mass = Body.Mass..g.,
    sex = Sex,
    delta_15_N = Delta.15.N..o.oo.,
    delta_13_C = Delta.13.C..o.oo.,
    species = Species,
  ) 

names(data)
# Verification of missing data
colSums(is.na(data)) 

```

Change species names :  
```{r}
data = data %>%
  mutate(species = recode(species, "Adelie Penguin (Pygoscelis adeliae)" = "Adelie", "Chinstrap penguin (Pygoscelis antarctica)" = "Chinstrap", "Gentoo penguin (Pygoscelis papua)" = "Gentoo"))
```


Distribution of species between the islands :  

```{r}
table(data$island, data$species)
```

Some graphs :

```{r}
ggplot(data, aes(x = flipper_length, y = body_mass, color = species))+
  geom_point()+
  theme_classic()
```

```{r}
ggplot(data, aes(x = culmen_length, y = culmen_depth, color = species))+
  geom_point()+
  theme_classic()
```

```{r}
ggplot(data, aes(x = delta_15_N, y = delta_13_C, color = species, shape = island))+
  geom_point()+
  theme_classic()
```

```{r}
#Selection of quantitative data
data_numeric <- select_if(data, is.numeric)

# Remove sample_number 
# The body_mass et the flipper_length are more than 80% correlated, we're deleting flipper_length because it's the data that's most correlated with all the other data.
# names(data_numeric)
data_numeric <- data_numeric %>% select(-c("sample_number","flipper_length"))

# Normalizing data
data_scales <- scale(data_numeric)

#PCA realization
acp_data= PCA(data_scales, graph = F)
summary(acp_data)

#Variance for each component
fviz_eig(acp_data)

#Contribution of axis variables axis 1 and 2
fviz_contrib(acp_data, choice="var", axes=1) #axe 1
fviz_contrib(acp_data, choice="var", axes=2) #axe 1

#Correlation circle
fviz_pca_var(acp_data)

# Projection of individuals and differentiation according to species
fviz_pca_ind(acp_data, geom.ind = "point", habillage = data$species, addEllipses = T, pointshape = 19)

#Projection of variables and individuals and differentiation according to species
fviz_pca_biplot(acp_data, label="var", habillage=data$species, title = "Projection of variables and individuals according to species", ylim=c(-3,3.5), xlim = c(-3.5,3.5))

# Projection of individuals and differentiation according to the islands
fviz_pca_ind(acp_data, geom.ind = "point", habillage = data$island, addEllipses = T, pointshape = 19)
#Projection of variables and individuals and differentiation according to the islands
fviz_pca_biplot(acp_data, label="var", habillage=data$island, title = "Projection of variables and individuals and dfferentiation according to the islands", ylim=c(-3,3.5),xlim = c(-3.5,3.5))

```
First, we look at the inertia of each axis (Figure 1). We can see that the first 2 axes capture almost 78.4% of the inertia, which is very good. If we look at the contribution of the variables for each axis, we can see that 3 variables make a strong contribution to axis 1 (delta_15_N, body_mass and culmen_depth) and 2 to axis 2 (culmen_depth and delta_13_C) (Figure 2).

We then obtain the circle of correlations, which coincide with the contributions previously observed (Figure 3).

We then project the individuals according to their species. We can observe 3 distinct groups corresponding to the 3 species present in the dataset (Figure 4 and 5). Gentoo penguins have a greater mass and a longer culmen. Adelies are lighter and have a depth culmen. Chinstrap penguins are the lightest and have a long, depth culmen. Adelies and Chinstrap penguins both have a high concentration of carbon 13 and nitrogen 15.

Next, we look at the distribution of individuals on the islands, by colouring the individuals with this factor. We can see that Gentoo penguins live only on Biscoe Island, while Chinstrap penguins live mainly on Dream Island. Adelie penguins live on these two islands and also on Togersen Island.

The common habitats of Chinstrap and Adelie penguins seem to explain the presence of isotopes in these two species, as they must find a similar diet.




 
```{r NA}
NA_df <- (colSums(is.na(data)) / nrow(data)) * 100

color_pal <- colorRampPalette(c("limegreen", "yellow", "firebrick"), bias = 20)(10)
NA_col <- color_pal[as.integer(NA_df/length(NA_df)*9)+1]

# Graphique
barplot(NA_df, main = "NA quantity per column",
        ylab = "NA", col = NA_col, las=2, cex.names=0.4)

NA_mean<-mean(NA_df)
# 0.78% 

abline(h=NA_mean, col = "red", lwd = 2)

```


```{r violin}

# Violin plot for Culmen Length (beak length)
ggplot(data, aes(x = species, y = culmen_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Culmen Length by Species",
       x = "Species",
       y = "Culmen Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Flipper Length
ggplot(data, aes(x = species, y = flipper_length, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Flipper Length by Species",
       x = "Species",
       y = "Flipper Length (mm)") +
  theme_minimal() +
  theme(legend.position = "none")

# Violin plot for Body Mass
ggplot(data, aes(x = species, y = body_mass, fill = species)) +
  geom_violin(trim = FALSE) +
  geom_jitter(shape = 16, position = position_jitter(0.2), color = "black", alpha = 0.3) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 3, fill = "red", color = "red") +
  labs(title = "Distribution of Body Mass by Species",
       x = "Species",
       y = "Body Mass (g)") +
  theme_minimal() +
  theme(legend.position = "none")

```

